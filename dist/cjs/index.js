"use strict";var u=Object.defineProperty,x=Object.defineProperties,b=Object.getOwnPropertyDescriptors,g=Object.getOwnPropertySymbols,f=Object.prototype.hasOwnProperty,v=Object.prototype.propertyIsEnumerable,m=(a,t,e)=>t in a?u(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e,o=(a,t)=>{for(var e in t||(t={}))f.call(t,e)&&m(a,e,t[e]);if(g)for(var e of g(t))v.call(t,e)&&m(a,e,t[e]);return a},w=(a,t)=>x(a,b(t));class y{constructor(t,e){this._options={dict404:"",doAllowEscapeChar:!1,doAllowWhitespace:!1,maxChars:64,maxWhitespace:64,tags:{close:"}}",open:"{{"},validChars:"a-zA-Z0-9_-"},this._template="",this._templateMap={},this._templateModel=[],this._templateEngine=s=>{const r=o({},this._templateMap),h=[...this._templateModel];for(let i=0,c=Object.keys(s),n=c.length;i<n;i++){const p=c[i];if(r[p]!==void 0)for(let l=0,_=r[p].length;l<_;l++)h[r[p][l]]=s[p]}return"".concat(...h)},this._map=s=>{const r=this.getDict404(),h=!!this._options.doAllowEscapeChar,i=this._regexp,c={},n=[];let p=0,l=null;for(;(l=i.exec(s))!==null;){if(h&&l[0][0]==="!"){n.push(s.slice(p,l.index),s.slice(l.index+1,i.lastIndex)),p=i.lastIndex;continue}const _=l[1];c[_]||(c[_]=[]),n.push(s.slice(p,l.index),r),c[_].push(n.length-1),p=i.lastIndex}n.push(s.slice(p)),this._templateMap=o({},c),this._templateModel=[...n]},this._options=w(o(o({},this._options),t),{tags:o(o({},this._options.tags),t?.tags)}),this.setDict(e||{}),this.setDict404(this._options.dict404);const d=this._options.doAllowWhitespace?`\\s{0,${this._options.maxWhitespace}}`:"";this._regexp=new RegExp(`${this._options.doAllowEscapeChar?"!?":""}${this._options.tags.open}${d}([${this._options.validChars}]{1,${this._options.maxChars}})${d}${this._options.tags.close}`,"g"),this._engine=this._options.doAllowEscapeChar?(s,r)=>s.replace(this._regexp,(h,i)=>h[0]==="!"?h.slice(1):r[i]||this._dict404):(s,r)=>s.replace(this._regexp,(h,i)=>r[i]||this._dict404)}getDict(){return this._dict}setDict(t){this._dict=o({},t)}getDict404(){return this._dict404}setDict404(t){this._dict404=t}getTemplate(){return this._template}setTemplate(t){this._map(t),this._template=t}compile(t,e){return this._engine(t,e?o({},e):o({},this.getDict()))}template(t){return this._templateEngine(t?o({},t):o({},this.getDict()))}}module.exports=y;
